<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <style>
        /* CSS部分は元のデザインを100%維持しています */
        body { 
            margin: 0; width: 1920px; height: 1080px; background: none; overflow: hidden; 
            font-family: "Arial Black", "Avenir Next", "Segoe UI", "Meiryo", sans-serif;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
        }
        #header-container { display: flex; align-items: flex-start; justify-content: center; margin-top: -50px; margin-bottom: 110px; }
        .header-item { background: rgba(61, 62, 176, 0.85); color: white; height: 110px; display: flex; flex-direction: column; justify-content: center; align-items: center; position: relative; }
        .team-indicator { width: 450px; transition: all 0.4s ease; }
        .team-indicator.alpha { clip-path: polygon(0 0, 90% 0, 100% 100%, 0 100%); border-top: 6px solid #FFD541; }
        .team-indicator.bravo { clip-path: polygon(11% 0, 100% 0, 100% 100%, 2% 100%); border-top: 6px solid #005DA1; margin-left: -2px; }
        #match-info { width: 220px; background: rgba(61, 62, 176, 0.85); clip-path: polygon(3% 0, 97% 0, 80% 93%, 23% 93%); z-index: 10; margin: 0 -40px; padding: 6px 0; line-height: 1.4; font-family: "Helvetica Neue", "Arial", "Hiragino Kaku Gothic ProN", "Hiragino Sans", "Meiryo", sans-serif; }
        .info-text { display: block; font-weight: 900; text-align: center; }
        .info-main { font-size: 20px; color: #fff; margin-bottom: 2px; }
        .info-sub { font-size: 20px; opacity: 0.9; }
        .team-content { display: flex; align-items: flex-start; justify-content: space-around; width: 100%; padding: 0 15px; box-sizing: border-box; height: 70px; }
        .team-info-box { display: flex; flex-direction: column; align-items: center; flex-grow: 1; width: 280px; margin-top: 20px; }
        .team-kana { font-size: 14px; opacity: 0.8; height: 16px; margin-bottom: 5px; font-weight: normal; }
        .team-name { font-size: 18px; font-weight: 900; line-height: 1.1; text-align: center; white-space: nowrap; overflow: hidden; }
        .team-score { font-size: 58px; font-weight: 900; min-width: 70px; text-align: center; padding-top: 35px; line-height: 1; }
        #alpha-score { margin-right: 20px; }
        #bravo-score { margin-left: 20px; }
        .phase-label { font-size: 28px; font-weight: 900; margin-top: -5px; height: 45px; display: flex; align-items: center; transition: all 0.3s ease; }
        #display-alpha .phase-label { margin-right: 80px; }
        #display-bravo .phase-label { margin-left: 80px; }
        .active-ban { border-bottom: 6px solid #ff3333; color: #ff3333 !important; }
        .active-pick { border-bottom: 6px solid #ffba39; color: #ffba39 !important; }
        .row { display: flex; justify-content: center; gap: 45px; margin-bottom: 30px; }
        .slot { position: relative; width: 350px; height: 303px; clip-path: polygon(25% 0%, 75% 0%, 100% 50%, 75% 100%, 25% 100%, 0% 50%); display: flex; justify-content: center; align-items: center; background: rgba(255, 255, 255, 0.1); }
        .inner-img { position: absolute; width: 94%; height: 94%; clip-path: polygon(25% 0%, 75% 0%, 100% 50%, 75% 100%, 25% 100%, 0% 50%); z-index: 2; background: #000; }
        .inner-img img { width: 100%; height: 100%; object-fit: cover; }
        .char-name-container { position: absolute; bottom: 12%; left: 50%; transform: translateX(-50%); width: 85%; text-align: center; z-index: 10; }
        .char-name { font-weight: 900; color: white; text-shadow: 2px 2px 0 #000, -2px -2px 0 #000, 2px -2px 0 #000, -2px 2px 0 #000; line-height: 1.1; }
        .slot.is-ban .inner-img { filter: grayscale(1) brightness(0.2); }
        .slot.is-ban::after { content: "BAN"; position: absolute; color: #ff3333; font-size: 80px; font-weight: 900; z-index: 30; border: 8px solid #ff3333; padding: 0 10px; transform: rotate(-15deg); }
        .slot.is-pick { transform: scale(1.1); background: #ffba39; box-shadow: 0 0 40px rgba(255, 186, 57, 0.8); z-index: 10; }
    </style>
</head>
<body>
    <div id="header-container">
        <div id="display-alpha" class="team-indicator alpha header-item">
            <div class="team-content">
                <div class="team-info-box">
                    <span id="alpha-kana" class="team-kana"></span>
                    <span id="alpha-name" class="team-name">YELLOW TEAM</span>
                </div>
                <span id="alpha-score" class="team-score">0</span>
            </div>
            <span class="phase-label">WAITING</span>
        </div>
        
        <div id="match-info" class="header-item">
            <span class="info-text info-main">本戦</span>
            <span id="info-round" class="info-text info-sub">一回戦</span>
            <span id="info-bo" class="info-text info-sub">BO3</span>
            <span id="info-set" class="info-text info-main">第1セット</span>
        </div>

        <div id="display-bravo" class="team-indicator bravo header-item">
            <div class="team-content">
                <span id="bravo-score" class="team-score">0</span>
                <div class="team-info-box">
                    <span id="bravo-kana" class="team-kana"></span>
                    <span id="bravo-name" class="team-name">BLUE TEAM</span>
                </div>
            </div>
            <span class="phase-label">WAITING</span>
        </div>
    </div>

    <div class="row" id="row-top"></div>
    <div class="row" id="row-bottom"></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDnNBvjjgg24swnbnchts8imAFckbBtQbE",
            authDomain: "ap-eventtool.firebaseapp.com",
            projectId: "ap-eventtool",
            storageBucket: "ap-eventtool.firebasestorage.app",
            messagingSenderId: "1054354601976",
            appId: "1:1054354601976:web:d660ed86e2a91415acc80d",
            databaseURL: "https://ap-eventtool-default-rtdb.asia-southeast1.firebasedatabase.app"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // ステージリストの生成（デザイン部分）
        const images = ["01_ユノハナ大渓谷.png", "05_ナメロウ金属.png", "08_マヒマヒリゾート&スパ.png", "09_海女美術大学.png", "13_クサヤ温泉.png", "17_タラポートショッピングパーク.png", "18_コンブトラック.png"];
        images.forEach((src, i) => {
            const rawName = src.split('_')[1].split('.')[0];
            let displayName = rawName;
            if (rawName.length === 11) displayName = rawName.substring(0, 4) + "<br>" + rawName.substring(4);
            else if (rawName.length >= 12) displayName = rawName.substring(0, 5) + "<br>" + rawName.substring(5);
            const fontSize = (rawName.length < 10) ? "22pt" : "16pt";
            const div = document.createElement('div');
            div.className = 'slot'; div.id = `slot-${i}`;
            div.innerHTML = `<div class="inner-img"><img src="${src}"></div><div class="char-name-container"><div class="char-name" style="font-size: ${fontSize};">${displayName}</div></div>`;
            if (i < 4) document.getElementById('row-top').appendChild(div); else document.getElementById('row-bottom').appendChild(div);
        });

        function getTeamFontSize(name) {
            const len = name ? name.length : 0;
            if (len <= 8) return "32px";
            if (len <= 12) return "26px";
            if (len <= 16) return "22px";
            return "18px";
        }

        // Firebaseからリアルタイム受信
        const matchRef = ref(db, 'match_state');
    onValue(matchRef, (snapshot) => {
        const data = snapshot.val();
        if (!data) return;

        // 試合情報更新
        document.getElementById('info-round').textContent = data.matchInfo?.round || "本戦";
        document.getElementById('info-bo').textContent = data.matchInfo?.bo || "BO3";
        document.getElementById('info-set').textContent = data.matchInfo?.set || "第1セット";

        // チーム情報更新 (alpha)
        const a = data.alpha || {};
        const aEl = document.getElementById('alpha-name');
        aEl.textContent = a.name; 
        aEl.style.fontSize = getTeamFontSize(a.name);
        document.getElementById('alpha-score').textContent = a.score || 0;
        document.getElementById('alpha-kana').textContent = a.kana || '';

        // チーム情報更新 (bravo)
        const b = data.bravo || {};
        const bEl = document.getElementById('bravo-name');
        bEl.textContent = b.name; 
        bEl.style.fontSize = getTeamFontSize(b.name);
        document.getElementById('bravo-score').textContent = b.score || 0;
        document.getElementById('bravo-kana').textContent = b.kana || '';

        // BAN/PICKスロット更新
        if (data.slotsStatus) {
            data.slotsStatus.forEach((s, i) => {
                const el = document.getElementById(`slot-${i}`);
                if (el) {
                    el.classList.toggle('is-ban', !!s.ban);
                    el.classList.toggle('is-pick', !!s.pick);
                }
            });
        }
            // フェーズ表示の更新
            const alphaHeader = document.getElementById('display-alpha');
            const bravoHeader = document.getElementById('display-bravo');
            alphaHeader.className = 'team-indicator alpha header-item';
            bravoHeader.className = 'team-indicator bravo header-item';
            
            const aLabel = alphaHeader.querySelector('.phase-label');
            const bLabel = bravoHeader.querySelector('.phase-label');
            aLabel.textContent = 'WAITING'; bLabel.textContent = 'WAITING';

            if (data.activePhase && data.activePhase.team) { // teamが空でない場合のみ実行
                const target = data.activePhase.team === 'alpha' ? alphaHeader : bravoHeader;
                const label = data.activePhase.team === 'alpha' ? aLabel : bLabel;
                target.classList.add(data.activePhase.type === 'ban' ? 'active-ban' : 'active-pick');
                label.textContent = data.activePhase.type === 'ban' ? 'BAN PHASE' : 'PICK PHASE';
            }
        });
    </script>
</body>

</html>